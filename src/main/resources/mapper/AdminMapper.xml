<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.cdu.questionnaire.dao.AdminDao">
    <select id="queryUser" resultType="java.lang.String">
        select userName from `user` where isRegister = '0';
    </select>

    <select id="queryAllUser" resultType="java.lang.String">
        select userName from `user` where isRegister = '1' ;
    </select>

    <select id="queryQuesByUser" resultType="java.lang.String">
        select quesName from question where id in (select quesId from userques where userId in (select id from `user` where username=#{userName}) and isSub= '1')  ORDER  BY createTime desc limit #{pageNumber},5;
    </select>

    <select id="searchUser" resultType="java.lang.String">
        select userName from `user` where userName like concat('%',#{dynamicId},'%');
    </select>

    <select id="queryQuesTime" resultType="java.util.Map">
        select q.id as quesId,u.id as userId ,0 as isSub from question q ,`user` u where  (q.endTime-now())>0 and userName=#{userName} ;
    </select>

    <select id="queryAuditUser" resultType="int">
        select count(*) from `user` where userName = #{userName};
    </select>

  <!--  <select id="detailQues" parameterType="java.lang.String" resultType="java.util.Map">
        select id,fieldName,chosse,chosseType from field where quesId=#{quesId};
    </select>-->

    <update id="agreeAuditUser" parameterType="java.lang.String">
        update `user` set isRegister = '1'  where userName = #{userName} ;
    </update>

    <update id="refuseAuditUser" parameterType="java.lang.String">
        update `user` set isRegister = '2'  where userName = #{userName} ;
    </update>

    <insert id="writeQuesById" parameterType="java.util.List">
        insert into userques (quesId,userId,isSub)
        values
        <foreach collection="list" item="item" index="index" separator=",">
            (#{item.quesId,jdbcType=INTEGER},
             #{item.userId,jdbcType=INTEGER},
             #{item.isSub,jdbcType=INTEGER})


        </foreach>
    </insert>

    <update id="updateUserDoctor">
        UPDATE `user`
        SET doctorId=#{doctorId}
        WHERE id = #{userId};
    </update>

    <select id="selectDoctors" resultType="com.cdu.questionnaire.pojo.User">
       SELECT id , userName ,  DATE_FORMAT(registerTime , '%Y-%m-%d %H:%i:%s') as registerTime , isRegister , doctorId
       FROM `user`
       WHERE id IN (SELECT userId FROM userrole WHERE roleId = 3);
    </select>


</mapper>